我这个是总体需求是对中小的贸易企业的，所以用普通的java服务器，并且仅仅只是内部使用。有如下的
   - 供货商的信息
   - 供货商的货的资料。
   - 样品信息
   - 客户信息
   - 员工信息
   - 订单信息
   - 财务相关信息，请注意，我这个不是作为专业的财务，毕竟里边有很多不同的规则，我这里仅仅只是记账软件。
     - 报销单
     - 订单

请注意，我这个不是作为专业的财务软件，而定位是记账软件，因为很多财务信息，我不太懂。
其中供货商和客户的信息是一个表，且不同的部分可以做到不互相查看对方的资料。但既然牵涉到订单，那就牵涉到发货以及相关的财务结算。
我这里先分解几个用例，用例，人、事、物和规则。
   - 人
      - 业务员
      - 业务经理
      - 财务
      - 总经理
  - 事
    - 就是增改删差->物
  - 物
    - 供货商和客户的资料
    - 订单资料
    - 样品资料
    - 员工资料
    - 财务模块
  - 规则
    - 要注意权限，业务员只能联系编辑他自己的资料。
    - 产品部门经理可以编辑他手下客户的资料
    - 财务，可以查看整个的财务动向。

这里做一下整合
   - 订单模块，样品和大货是统一的，都在订单中，但是是不同的类型，可以自定义订单的类型，比如样品，大货，样品整合到这个订单模块。
     - 因为供货商的订单号跟客户的订单号是不一致的，但货是同一批货，这里要支持跟踪功能。这个应该是类比一棵树了。一个客户的订单对应多个供货商的订单号。所以这里是有3种订单号，一个是客户订单号，一个是供货商订单号，一个是贸易公司的订单号。
     - 也就是说，一个贸易公司的订单号对应多个客户的订单号，客户的订单号对应多个供货商的订单号。
   - 供货商和客户的资料，不分类别，毕竟供货商也可以是客户,客户也可以是供货商。
   - 员工资料跟权限是一起的。
   - 产品资料，
关于财务管理
   - 资产
     - 应收账款
   - 收入
   - 支出
   - 所有权权益
   - 发票

下边我整理一下表吧
   - 联系人表
     - 常规的，联系人，手机，电话，邮箱等等。
     - 介绍人，谁介绍的，可以写外部人员，也可以支持公司内部人员，也支持介绍人的链条。
       - 因为这个介绍人，所以我将客户，供货商和员工3个都放在这一个表中。
   - 用户表 ： 单纯用来控制登录的。
     - 联系人的id
     - 用户名和密码
     - 联系人id ： 这个用于权限的。
   - 权限表 ： 控制登录的权限的。
     - 用户表的id
     - 各种权限
   - 订单表
     - 联系人id
     - 订单id
     - 上一层的订单
     - 时间
   - 账户：accounts，账户的类别
     - id ：账户id
     - name : 账户名称
     - type : 账户类别
     - description ： 账户简介
     - parendId : 父账户的id
   - 账单： billterms ， 实际上是付款方式。
   - 预算金额 ： budget_amounts 
   - 预算 ： budgets

我这个，每个人只能查看他自己的订单，也可以查看他相关联的客户，但却不能查看他的客户的所有订单。

查询：
   - 业务员可以查看他的所有的订单。
   - 业务员可以查看他所有的客户或者供货商的信息。
   - 经理可以查看他不部门下所有的订单
   - 经理可以查看他部门下所有客户或者供货商的信息。
   - 经历可以查看某个客户下所有的订单信息。
修改：
   - 只有经理才可以修改订单信息。
   - 只有经历才可以修改客户或者供货商的信息。

为了支持如上的，需要有权限系统。
   - 一个用户只能查看他可以查看到的联系人信息以及他的联系人跟他相关的订单信息。
   - 只有相关人员可以修改某个联系人或者订单的信息，
   - 我这里用树形结构来实现吧。
   - 每一个联系人都有查、修改权限，
   - 每一个联系人下的每一个订单都有查、修改权限。
   - 一个联系人的创建者自动拥有这个联系人的查、修改权限以及属于这个联系人的所有订单的查、修改权限。
     - 这个要求我的联系人中要添加一项，创建者，
   - 为了支持比如某业务部门经理可以查看和修改下属业务员的订单，这个权限控制是分2个部分的，第一个是看所有者，所有者以及他的领导是拥有查看和修改权限的。另外单独的权限表，
   - 角色：
     - 业务部：
       - 业务经理
       - 业务员
     - 财务部
       - 财务

我先总结一下对外提供的接口是什么
   - 用户方面：
     - 创建用户 ： 经理以上人员
     - 修改用户 ： 用户自己以及经理以上人员
     - 查询用户 ： 经理以上人员
     - 删除用户 ： 经理以上人员
   - 联系人
     - 创建联系人 ： 所有
     - 修改联系人 ： 创建者以及以上人员
     - 查询联系人 ： 创建者以及以上人员或者自定义
   - 订单
     - 创建订单 ： 所有
     - 修改订单 ： 创建者以及以上人员
     - 查询订单 ： 创建者以及以上人员或者自定义
   - 产品
     - 创建产品 ：所有
     - 修改产品 ：创建者以及以上人员
     - 查询产品 ：所有
   - 订单项目
     - 创建订单项目 ： 创建者以及以上人员或者自定义
     - 修改订单项目 ： 创建者以及以上人员
     - 查询订单项目 ： 创建者以及以上人员或者自定义
   - 产品类别
     - 创建产品类别 ： 所有
   - 产品属性
     - 创建产品属性 ： 所有

局部总结：
   - 对于创建者和以上人员，默认可以修改和查询。
   - 可以自定义其他的权限。

请注意！！！ 
   - 我这里的权限控制指的是，对于具体的某个联系人和具体的某个订单和具体的某个订单项目的权限，比如
     - 对于一个具体的联系人，权限分user和admin权限，user只能查看，而admin可以修改。
     - 对于一个具体的订单，权限分user和admin权限，user只能查看，而admin可以修改。
     - 对于一个具体的订单项目，权限分user和admin权限，user只能查看，而admin可以修改。
   - 创建者自动获得admin权限。
   - 财务角色finance，默认情况下对联系人，订单，订单项目都具有查看的user权限。
   - 总经理角色general manager，默认拥有所有的admin权限。

角色：
   - Salesman ： 业务员
   - Business Manager ： 业务经理
   - finance ： 财务
   - general manager ： 总经理

权限：
   - user ： 查看权限
   - admin ： 修改权限

总结：
   - 联系人
     - 某个业务员创建了一个联系人，他就是创建者，他具备admin权限。
     - 其业务经理和总经理自动获得admin权限。
     - 创建者或其领导可以查看修改这个联系人所有的订单和订单项目。
   - 订单
     - 某个业务员根据某个联系人创建了一个订单，他就是创建者，他具备admin权限。
     - 其业务经理和总经理自动获得admin权限。
     - 创建者或其领导可以查看修改这个订单下面的所有订单项目
   - 订单项目
     - 某个业务员根据某个联系人创建了一个订单，他就是创建者，他具备admin权限。
     - 其业务经理和总经理自动获得admin权限。

有两个方案：
   - 在创建一个联系人的时候，创建者和其领导的权限同时添加到权限表。
     - 好处 ： 只是在这个权限表查询就可以了
     - 坏处，当业务员离开的时候，要更改一堆的东西。
   - 判断权限的时候，首先查看是创建者是谁，然后看看谁是其领导。

注意： 
   - 当某个员工离职，这个创建者身份就不好使了，并且我也要支持这个创建者身份，
   - 客户的创建者和某个业务员负责某个客户是两个概念。
   - 某个订单的创建者可以查看修改这个订单下所有的订单项目的信息。

我这里创建一个权限树吧，唯一的例外是财务吧，这个跟业务是同级的，但我却不想给他们很高的权限，他们不能修改联系人或者订单。
   - 每个联系人是一个节点
   - 联系人下的每一个订单是一个节点
   - 订单下的每一个项目是一个节点。
几个表：
   - 用户表 ： 里边保存用户的登录信息以及从属信息。
   - 角色表 ： 
   - 权限表3个 ：
     - 联系人权限表
     - 订单权限表
     - 订单项目权限表

为了支持客户的某个产品项目分成几家公司做，这里的某个订单项目是可以分解成多个订单的，
我这里还是用另一种方式吧：
   - 客户和供货商的订单是两个独立的订单号。
   - 订单号下边是具体的订单项目，
   - 有个对应表，客户的下的具体的订单项目对应着供货商下具体的订单项目。

问题 ： 一个客户的创建者是否可以查看深层次的单子的信息。
重新组织一下，这个要能知道某个客户以前都被推销过什么单子。
   - 联系人表
   - 用户表
   - 权限表
   - 产品表
   - 订单表
   - 订单项目表
   - 推荐产品表
   - 产品类别
   - 产品属性

重新组织一下表的权限，因为人员跳槽问题，所以这里所有的权限控制都是放在表中，每一个联系人或者订单之类的创建的时候就已经有默认的权限了。

   - 联系人表
     - 两种权限，user和admin
     - 权限区别：
       - user ： 可以查看这个联系人，可以查看自己跟这个联系人相关的订单。
       - admin ： 可以编辑这个联系人，可以查看这个联系人所有的订单。
   - 用户表：
     - 包括
       - id
       - 用户名
       - 密码
       - 联系人id
   - 产品表
     - 产品表 ： 两种权限，公共的指的是所有人都可以查看这个权限，而私有的指的是只有创建者可以修改这个产品
   - 产品图片表
     - 产品表的附属
   - 产品属性表
     - 产品表的附属
   - 产品属性值表
     - 产品表的附属
   - 订单表
     - 创建订单的时候，默认创建者和其领导都拥有admin权限，其他人也可以赋予user权限。
     - user和admin都可以查看这个订单的订单项目和对应的供货商的订单项目。
     - 权限区别：
       - user ： 只能查看
       - admin ： 可以修改订单项目。
     - 这个订单表有一项是订单项目，
   - 订单项目表 ：
     - 订单表和订单项目表好像是循环引用，需要更改一下。

我这里再整理一下需求：
   - 联系人 ： 包括客户和供货商
   - 用户 ： 用于登录的。
   - 权限 ： 用户各种权限
   - 角色 ： 公司内的各种角色
     - 角色用户是多对多的关系。
   - 产品 ：
     - 产品图片
     - 产品属性
     - 产品属性值
   - 订单 ：
     - 订单项目
   - 信息 ： 各个用户之间发送的信息的，请注意这里保存的是联系人id，以备将来有不是用户之间的信息。

再次总结：
   - 联系人表 ： 客户和供货商都在其中。
     - 联系人只能被至少是有查看权限的人查看到。
     - 联系人只能被有修改权限的人才能修改。
     - 可以查看某个联系人下的订单，但至少得有查看权限。
   - 用户表 ： 主要保存登录信息的。
   - 角色表 ： 
     - Salesman ： 业务员
     - Business Manager ： 业务经理
     - finance ： 财务
     - general manager ： 总经理
   - 用户角色表 ： 某个用户所对应的角色，这个是自动生成的，用户对角色表是多对多的。
   - 联系人权限表 ：某个用户对某个联系人的权限。
   - 产品表：
   - 产品图片表
   - 产品属性表
   - 产品类别表
   - 产品属性值表
   - 订单表
   - 订单项目表
   - 订单权限表

关于权限方面
   - 分几种权限吧
     - 联系人的权限
     - 订单的权限
     - 订单项目的权限
   - 联系人方面：
     - 比如业务员查看联系人，只能查看到这个业务员可以查看到的联系人。
     - 作为user权限的业务员，也只能查看到这个联系人跟自己相关的订单。
     - 作为admin权限的，则可以查看所有的订单。
     - 编辑方面，只能有admin权限的。
   - 订单方面的：
     - user和admin的都可以查看这个订单的所有订单项目。
     - 但只有admin权限的才可以修改这个订单的所有订单项目。

重要！！！ 想了一下，某个业务经理创建了一个新的订单，有很多订单项目，他交给业务员，是并不需要告诉业务员这个客户的详细信息的，另外订单是分两种的，一种是客户提供款式，然后贸易公司找代加工工厂去做的，而另一种是贸易公司提供的款式，客户直接下单的。
我这里的流程是这样子的
   1. 业务员接到客户的生产订单。
   2. 业务员将客户订单中的产品全部添加到产品中。
   3. 业务员创建一个新的订单，订单中的产品是在如上产品
   4. 现在业务员要选择将这些产品分给供货商了，这里要支持同时将几个产品分给一个供货商，然后创建一个新的订单。



我这里总结一下业务层service的接口吧
   - 联系人
     - 增加联系人 ： 所有人都可以
     - 查询联系人 ： 有权限的才可以，包括user和admin
     - 修改联系人 ： admin的才可以。
   - 用户 
     - 主要用于登录的。
     - 新建用户，经理权限的才可以新建联系人。
   - 产品：请注意产品有公有和私有的区别，公有的所有人都可以查看，而私有的得看权限表。
     - 增加产品：所有人都可以
     - 查询产品
       - 查询某个人所能够查看的所有产品
       - 查询某个联系人的所有产品。
     - 修改产品 ： 得看权限表。
       - 修改产品实际上是修改
         - 产品图片
         - 产品属性值。
   - 产品属性表 ： 所有人都可以增加和查询，但不可以修改和删除了。
   - 订单 ：
     - 增加订单 ： 
       - 权限，典型情况，某个业务员可以访问某个联系人的时候，才可以在这个联系人的下边新建订单。
     - 查询订单：
       - 查询这个人所能够查看的所有订单
       - 查询某个联系人的所有订单。
     - 修改订单 ： 得看权限表
       - 修改订单实际上是修改订单项目，修改订单后会自动发送信息给所有相关方面。
     - 订单完结是手动的，且会通知所有的订单相关方。
   - 信息
     - 发送信息
     - 查询信息

前面没有加上时间，这里加上时间吧
2021-9-20 ： 更新 ：
   - 关于订单方面，我想要分成2个表来表达，
     - 订单表 ： 可以有上一层的订单项目表，表示这一个订单是这个订单项目的分支，
     - 订单向目标 ： 具体的订单的，
     - 订单和订单项目表是多对多的关系。也就是一个订单对应多个订单项目，而一个订单项目或许也对应着多个订单。
     - 关于订单的权限方面：比如在客户的订单中是可以查看到供货商的订单的。
     - 但还有个问题，这样子好像不能将多个供货商的订单项目合并成一个订单的，所以，我的方式是，
       - 新建一个表，订单项目和订单项目的对照表。
2020-9-20 : 更新2
   - 关于联系人：
     - 查询： 
       - 查询这个人所能够联系的所有联系人。
       - 查询某个联系人的具体信息，这个会显示所有的产品和所有的订单。
   - 关于产品：
     - 查询
       - 查询所有的公共产品以及这个人能够联系的所有产品。
       - 查询某个产品的具体信息，这个会显示这个产品的具体信息和所有的订单。
   - 关于订单：
     - 查询
       - 查询某个具体的订单
         - 显示这个订单所有的订单项目
           - 显示这个订单项目的状态，被谁负责，以及订单项目的id